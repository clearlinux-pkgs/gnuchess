http://svn.savannah.gnu.org/viewvc/chess?view=revision&revision=182
Author:	aceballos
Date:	Sun Apr 5 11:24:05 2020 UTC (3 days, 10 hours ago)
Changed paths:	1
Log Message: Fix buffer overflow while copying string

--- trunk/src/frontend/cmd.cc	2020/04/05 11:15:57	181
+++ trunk/src/frontend/cmd.cc	2020/04/05 11:24:05	182
@@ -313,13 +313,20 @@
       if ( fgets( epdline, MAXSTR, epdfile ) == NULL ) {
         printf(_("Error reading file '%s'.\n"), token[1] );
       } else {
-        strcpy( data, "setboard " );
+        const char setboardCmd[] = "setboard ";
+        unsigned int setboardLen = strlen(setboardCmd);
+        strcpy( data, setboardCmd );
         int i=0;
         while ( epdline[i] != '\n' ) {
-          data[i+9] = epdline[i];
-          ++i;
+          if (i + setboardLen < MAXSTR - 1) {
+              data[i+setboardLen] = epdline[i];
+              ++i;
+          } else {
+              printf(_("Error reading contents of file '%s'.\n"), token[1] );
+              break;
+          }
         }
-        data[i+9] = '\0';
+        data[i+setboardLen] = '\0';
         SetDataToEngine( data );
         SetAutoGo( true );
       }
